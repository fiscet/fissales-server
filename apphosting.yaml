# Settings for Backend (on Cloud Run).
# See https://firebase.google.com/docs/app-hosting/configure#cloud-run
runConfig:
  minInstances: 1  # ✅ Mantieni sempre 1 istanza attiva
  maxInstances: 10  # ✅ Limita le istanze
  concurrency: 10  # ✅ 10 richieste per istanza
  cpu: 1  # ✅ 1 CPU
  memoryMiB: 1024  # ✅ 1GB RAM
  startupProbe:
    initialDelaySeconds: 10  # ✅ Ridotto da 60 a 10 secondi
    periodSeconds: 5  # ✅ Controlla ogni 5 secondi
    timeoutSeconds: 3  # ✅ Timeout 3 secondi
    failureThreshold: 3  # ✅ Fallisci dopo 3 tentativi
    tcpSocket:
      port: 8080
  outputFiles:
  serverApp:
    include: [dist, server.js]

# Environment variables and secrets.
env:
  - variable: NODE_ENV
    value: production
    availability:
      - BUILD
      - RUNTIME

  - variable: FIREBASE_PROJECT_ID
    value: fissales-chatbot
    availability:
      - BUILD
      - RUNTIME

  - variable: WEBSHOP_URL
    value: https://villma-by-chris.myshopify.com
    availability:
      - BUILD
      - RUNTIME

  - variable: SHOPIFY_API_VERSION
    value: 2025-04
    availability:
      - BUILD
      - RUNTIME

  - variable: LOG_LEVEL
    value: info
    availability:
      - BUILD
      - RUNTIME

  - variable: LOG_FILE
    value: logs/app.log
    availability:
      - BUILD
      - RUNTIME

  - variable: FIREBASE_PRIVATE_KEY
    secret: FIREBASE_PRIVATE_KEY
    availability:
      - BUILD
      - RUNTIME

  - variable: FIREBASE_CLIENT_EMAIL
    secret: FIREBASE_CLIENT_EMAIL
    availability:
      - BUILD
      - RUNTIME

  - variable: QDRANT_URL
    secret: QDRANT_URL
    availability:
      - BUILD
      - RUNTIME

  - variable: QDRANT_API_KEY
    secret: QDRANT_API_KEY
    availability:
      - BUILD
      - RUNTIME

  - variable: OPENAI_API_KEY
    secret: OPENAI_API_KEY
    availability:
      - BUILD
      - RUNTIME

  - variable: GOOGLE_API_KEY
    secret: GOOGLE_API_KEY
    availability:
      - BUILD
      - RUNTIME

  - variable: OPENROUTER_API_KEY
    secret: OPENROUTER_API_KEY
    availability:
      - BUILD
      - RUNTIME

  - variable: API_TOKEN
    secret: API_TOKEN
    availability:
      - BUILD
      - RUNTIME

  - variable: UPSTASH_REDIS_REST_URL
    secret: UPSTASH_REDIS_REST_URL
    availability:
      - BUILD
      - RUNTIME

  - variable: UPSTASH_REDIS_REST_TOKEN
    secret: UPSTASH_REDIS_REST_TOKEN
    availability:
      - BUILD
      - RUNTIME
